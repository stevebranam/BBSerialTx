<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BBSerialTx: Bit-Banged Serial Transmitter</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BBSerialTx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Bit-Banged Serial Transmitter </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro_sec">Introduction</a></li>
<li class="level1"><a href="#license_sec">License</a></li>
<li class="level1"><a href="#usage_sec">Usage</a></li>
<li class="level1"><a href="#connection_sec">Hardware Connection</a></li>
<li class="level1"><a href="#theory_sec">Theory Of Operation</a></li>
<li class="level1"><a href="#arduino_sec">Arduino Example</a></li>
<li class="level1"><a href="#build_sec">Build and Test</a></li>
<li class="level1"><a href="#analysis_sec">Analysis</a><ul><li class="level2"><a href="#specification_sec">Specification</a></li>
<li class="level2"><a href="#mcc_sec">MCC Analysis</a></li>
<li class="level2"><a href="#coverage_sec">Test Coverage Analysis</a></li>
</ul>
</li>
<li class="level1"><a href="#tools_sec">Tools</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This module implements a bit-banged serial transmitter over a GPIO line using the 8N1 protocol (8-bit data, No parity, 1 stop bit, see <a href="https://en.wikipedia.org/wiki/8-N-1">https://en.wikipedia.org/wiki/8-N-1</a>), emulating a UART transmitter (see <a href="https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter">https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter</a>). This is suitable for connection to a UART receiver for logging or other unidirectional communications.</p>
<p>BBSerialTx uses no external functions, timers, interrupts, DMA, UART's, or other MCU peripherals or resources, so it imposes minimal demands on the MCU or runtime context. As soon as you can bring up a single GPIO in any context, you can get serial output.</p>
<p>The only resource consumed is CPU time. This can affect timing-critical operations, so be sure the system can tolerate the delay imposed by outputting data. This can create Heisenbugs: the act of observing the system perturbs it.</p>
<p>The hardware connection is a two-wire connection: TX (the GPIO line) to RX, and GND to GND.</p>
<p>Note: GPIO is TTL-level, not RS-232 level, so the receiver must be a TTL UART device. RS-232 uses a different voltage range with inverted logic. If you need to output to an RS-232 device, you'll need a TTL/RS-232 converter between the devices. The converter may also need to be configured as a null modem.</p>
<h1><a class="anchor" id="license_sec"></a>
License</h1>
<p>MIT License in <a href="../../LICENSE">LICENSE</a>. You can use BBSerialTx as you like without restriction for commercial and non-commercial use, as long as you include the LICENSE file. See <a href="https://choosealicense.com/licenses/mit/">https://choosealicense.com/licenses/mit/</a> for more details.</p>
<h1><a class="anchor" id="usage_sec"></a>
Usage</h1>
<p>To use BBSerialTx on a target MCU, call <a class="el" href="BBSerialTx_8c.html#a9a96c8aca7c761ac5551f839af6a1c39" title="Opens the BBSerialTx channel.">BBSerialTx_Open()</a> and provide a write function that writes to the desired GPIO. This makes the GPIO behave like a UART transmitter. Perform any required setup of the GPIO before calling <a class="el" href="BBSerialTx_8c.html#a9a96c8aca7c761ac5551f839af6a1c39" title="Opens the BBSerialTx channel.">BBSerialTx_Open()</a>.</p>
<p>Use <a class="el" href="BBSerialTx_8c.html#a1b297a1c1eb2d0854ff3cd8e8830abfb" title="Outputs a calibration pattern on the BBSerialTx channel.">BBSerialTx_Calibrate()</a> to generate a test pattern that you can measure with a logic analyzer or oscilloscope to calculate the duration of a single call to the write function. Provide this value to <a class="el" href="BBSerialTx_8c.html#a9a96c8aca7c761ac5551f839af6a1c39" title="Opens the BBSerialTx channel.">BBSerialTx_Open()</a>. Once you've calibrated the module on a particular MCU, you no longer need the analyzer; you can send data from that MCU to any standard UART device, such as a USB-TTL Serial adapter.</p>
<p>Once you've opened the BBSerialTx channel with a calibrated value, you can output raw binary data, character strings, and ASCII decimal- or hex-formatted numerical values.</p>
<p>See the Google Test suite in <a href="../../test/tests.cpp">test/tests.cpp</a> for example usage, including a write function for off-target testing, and the <a class="el" href="index.html#arduino_sec">Arduino Example</a> below.</p>
<h1><a class="anchor" id="connection_sec"></a>
Hardware Connection</h1>
<p>This shows a typical hardware connection from the target MCU board running BBSerialTx to a terminal emulator program (such as minicom) running on a development host (in this case Ubuntu 20.04), using a USB-TTL Serial Adapter.</p>
<p>The adapter is typically connected via jumper wires either to pins on the MCU board, or to probes that contact points on the board, such as test points, solder pads, or leads on parts.</p>
<p>The connection is 2 wires, to the RX and GND of the receiving device. The receiver's TX line is unused.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_1.png" />
</div>
<p>That results in this communications sequence:</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_2.png" />
</div>
<p>Similarly, you can connect the target MCU board to any other TTL serial receiver, such as a UART on another board.</p>
<h1><a class="anchor" id="theory_sec"></a>
Theory Of Operation</h1>
<p>The <em>asynchronous serial 8N1 protocol</em> consists of a single unidirectional signal wire in each direction, transmit and receive (TX and RX). Normal communication is bidirectional via TX and RX.</p>
<p>Normal full communication between the <em>local</em> and <em>remote</em> devices consists of both transmitter and receiver functionality, with TX and RX wires <em>cross-connected</em> between them (i.e. local TX to remote RX and vice-versa).</p>
<p>Each device sends data to its peer by transmitting data on the TX wire to the RX wire on the other end, where the peer receives the data. This provides <em>point-to-point connection</em> between them (vs. <em>multi-point</em> or <em>broadcast connection</em>, where multiple devices may communicate with each other).</p>
<p>BBSerialTx implements only the transmit side, and expects that the remote peer device implements at least the the receive side.</p>
<p>The TX side signals bits by toggling the signal between high and low states, one bit at a time. This makes it <em>serial</em> (vs. <em>parallel</em>, which signals multiple bits at a time over multiple wires). The transmitter adds framing bits to the data bits to delimit them on the wire and provide error detection and recovery. These consist of start and stop bits (and optional parity bits).</p>
<p>The bit-time (the duration of each bit) is determined by the <em>baud rate</em> (the bit rate). Since there are 1 billion nsec (nanoseconds) in a second, the equation for bit-time in nsec is</p>
<blockquote class="doxtable">
<p>bit-time = 1,000,000 nsec / baud-rate </p>
</blockquote>
<p>For example, for the common baud rates 9600 and 115200, the bit-times are</p>
<blockquote class="doxtable">
<p>bit-time = 1,000,000 nsec / 9,600 baud = 104,166.67 nsec </p>
</blockquote>
<blockquote class="doxtable">
<p>bit-time = 1,000,000 nsec / 115,200 baud = 8,680.56 nsec </p>
</blockquote>
<p>A complete transmission of a framed data byte is a <em>symbol</em>. The <em>symbol rate</em> is the number of symbols, or framed data bytes, per second.</p>
<p>The 8N1 protocol consist of 8 data bits framed by a start bit, no parity bits, and 1 stop bit per symbol. Other combinations are possible, such 7N2 (7 data bits, no parity, 2 stop bits), 7E1 (for <em>even parity</em>, where the parity bit ensures that the number of 1-bits in the symbol is even), but 8N1 is virtually universal in modern use.</p>
<p>Since 8N1 adds two framing bits to 8 data bits, a symbol is 10 bits, so the symbol rate is 1/10th the baud rate. For example, 9600 and 115200 baud result in symbol rates of 960 and 11520 bytes, or characters, per second.</p>
<p>The bit value logic levels 0 and 1 (low and high) are known as <em>space</em> and <em>mark</em>, respectively. When the transmitter is not sending any data, it sets the line to the <em>idle</em> state, which is the mark level (i.e. 1, high). The start bit is the space level (i.e. 0, low), so that the line transitions from high to low to signal the start of a frame. The stop bit is the mark level, so that the line transitions back to high for at least one bit-time. It remains at high, idle, for a random period of time, until the transmitter sends the next frame.</p>
<p>Data bits are transmitted from LSB to MSB (Least Significant Bit to Most Signficant Bit), so they appear in reverse order in time on the wire.</p>
<p>This timing diagram shows sending the data byte 0x0D, bits 00001101, 10 bits total:</p>
<div class="fragment"><div class="line">    Idle    |Start|Data                                          |Stop |Idle</div>
<div class="line">                  |  1     0     1     1     0     0     0    0  |</div>
<div class="line"> </div>
<div class="line">    --------+     +-----+     +-----+-----+                      +-----+--------</div>
<div class="line">TX          |     |     |     |           |                      |   </div>
<div class="line">            +-----+     +-----+           +-----+-----+-----+----+   </div>
<div class="line">Bit Time       0     1     2     3     4     5     6     7     8    9</div>
</div><!-- fragment --><p>The RX side recovers data by monitoring the line for the transition from idle to start, 1 to 0. Since this could occur randomly at any unknown time, it is <em>asynchronous</em>. That completes the definition of <em>asynchronous serial 8N1</em>.</p>
<p>The start bit synchronizes the receiver. Since the RX side is configured for the same baud rate as the TX side, 8N1, it knows the bit-time. This tells it how to sample the signal, dividing it up into framing and data bits by time.</p>
<p>It accumulates the arriving bits to reassemble them into the received data byte. If it doesn't detect a stop bit at the right point in time, it declares a <em>framing error</em> for that symbol.</p>
<p>Once the symbol time has elapsed and the receiver has detected idle, it's ready to receive the next symbol. That allows it to recover from transient errors, for instance due to poor physical connection or electrical noise on the line.</p>
<p>But if TX and RX are configured differently, or TX doesn't send properly, or there is continuous electrical noise on the line, the receiver will declare continuous errors.</p>
<p>BBSerialTx works by setting the output GPIO line to the mark and space levels according to the protocol. It uses a write function that's passed in by pointer (function pointer) to set the line level.</p>
<p>It's also given a baud rate and a <em>write duration</em> in nsec; this is the time it takes to execute the write function and computational overhead on the particular board where it's running. For timing purpose, it simply calls the write function repeatedly, as many times as needed to maintain the output signal for the correct bit-time duration to achieve the desired baud rate.</p>
<p>The write duration must first be determined by performing a calibration run. The produces an output pattern on the GPIO that you can measure with a logic analyzer or oscilloscope. Once you know the duration of the pattern, you can calculate the duration of a write.</p>
<p>That architecture allows BBSerialTx to be platform-indepdent, tailorable to a specific platform.</p>
<h1><a class="anchor" id="arduino_sec"></a>
Arduino Example</h1>
<p>This example (Arduino_BBSerialTx.ino) uses the builtin yellow LED connected to pin 13 on an Arduino-compatible board as the GPIO channel. Using jumper wires, you can connect a USB-TTL Serial adapter to it to receive the output.</p>
<p>The specific calibration value is for an Elegoo MEGA2560 R3 board, which has an Atmel ATMEGA2560 MCU and 16 MHz crystal.</p>
<p>While this development board has headers for connecting to pin 13 and GND, solderless probes can be placed on the GND and pin 13 GPIO solder pads on either side of the yellow LED, as might be required on a production board.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_3.png" />
</div>
<p>Arduino uses ".ino" files instead of ".c" files. Add the files <a class="el" href="BBSerialTx_8c.html" title="Bit-banged serial transmitter (8N1)">BBSerialTx.c</a> and <a class="el" href="BBSerialTx_8h.html" title="Header for bit-banged serial transmitter (8N1)">BBSerialTx.h</a> to the sketch ("Sketch &gt; Add File..." in Arduino IDE 2.1.0) and rename <a class="el" href="BBSerialTx_8c.html" title="Bit-banged serial transmitter (8N1)">BBSerialTx.c</a> to BBSerialTx.ino (select the sketch in the Sketchbook and "Open Folder", then right-click on the file and select "Rename..."). Then upload the sketch to the board.</p>
<p>DON'T FORGET TO RENAME THE .c FILE to .ino! That causes all kinds of errors when the Arduino IDE compiles the sketch.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="BBSerialTx_8h.html">BBSerialTx.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define NEEDS_CALIBRATION 0</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <a class="code" href="BBSerialTx_8h.html#a394d8ab04e2c74ddf60fbebfd55b35dd">BBSerialTx_BaudRate_t</a>  baud_rate = 9600;</div>
<div class="line"><span class="keyword">const</span> <a class="code" href="BBSerialTx_8h.html#a1fd1a4c59f016e2c4b5a14ff7db0f432">BBSerialTx_WriteNsec_t</a> calibrated_nsec_per_write = 7100;</div>
<div class="line"> </div>
<div class="line">uint32_t loop_count;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Platform-specific function to write desired GPIO line, function pointer</span></div>
<div class="line"><span class="comment">// to be passed to BBSerialTx_Open() as &quot;write_function&quot; parameter.</span></div>
<div class="line"><span class="keywordtype">void</span> builtin_write(<a class="code" href="BBSerialTx_8h.html#a8611ad78cc5f08756013ff9eb760c25a">BBSerialTx_Bit_t</a> bit)</div>
<div class="line">{</div>
<div class="line">  digitalWrite(LED_BUILTIN, bit);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// put your setup code here, to run once:</span></div>
<div class="line">  pinMode(LED_BUILTIN, OUTPUT);</div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a9a96c8aca7c761ac5551f839af6a1c39">BBSerialTx_Open</a>(baud_rate, builtin_write, calibrated_nsec_per_write);</div>
<div class="line">  loop_count = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// put your main code here, to run repeatedly:</span></div>
<div class="line"><span class="preprocessor">#if NEEDS_CALIBRATION</span></div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a1b297a1c1eb2d0854ff3cd8e8830abfb">BBSerialTx_Calibrate</a>();</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a074d26ead8b441383287d56f9f87230c">BBSerialTx_WriteString</a>(<span class="stringliteral">&quot;Hello from Arduino! Up for &quot;</span>, 0);</div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#aceef961834b4015423081d547f913f2d">BBSerialTx_WriteDecimal</a>(millis(), 8);</div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a074d26ead8b441383287d56f9f87230c">BBSerialTx_WriteString</a>(<span class="stringliteral">&quot; msec, loop count 0x&quot;</span>, 0);</div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a82fdc5e457ec00df506ff1f66fa33469">BBSerialTx_WriteUint32</a>(loop_count);</div>
<div class="line">  <a class="code" href="BBSerialTx_8c.html#a074d26ead8b441383287d56f9f87230c">BBSerialTx_WriteString</a>(<span class="stringliteral">&quot;\r\n&quot;</span>, 0);</div>
<div class="line">  loop_count++;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">}</span></div>
<div class="ttc" id="aBBSerialTx_8c_html_a074d26ead8b441383287d56f9f87230c"><div class="ttname"><a href="BBSerialTx_8c.html#a074d26ead8b441383287d56f9f87230c">BBSerialTx_WriteString</a></div><div class="ttdeci">void BBSerialTx_WriteString(const char *string, size_t width)</div><div class="ttdoc">Outputs a character string on the open BBSerialTx channel.</div><div class="ttdef"><b>Definition:</b> BBSerialTx.c:163</div></div>
<div class="ttc" id="aBBSerialTx_8c_html_a1b297a1c1eb2d0854ff3cd8e8830abfb"><div class="ttname"><a href="BBSerialTx_8c.html#a1b297a1c1eb2d0854ff3cd8e8830abfb">BBSerialTx_Calibrate</a></div><div class="ttdeci">void BBSerialTx_Calibrate(void)</div><div class="ttdoc">Outputs a calibration pattern on the BBSerialTx channel.</div><div class="ttdef"><b>Definition:</b> BBSerialTx.c:103</div></div>
<div class="ttc" id="aBBSerialTx_8c_html_a82fdc5e457ec00df506ff1f66fa33469"><div class="ttname"><a href="BBSerialTx_8c.html#a82fdc5e457ec00df506ff1f66fa33469">BBSerialTx_WriteUint32</a></div><div class="ttdeci">void BBSerialTx_WriteUint32(uint32_t value)</div><div class="ttdoc">Outputs an ASCII hex-formatted UINT32 value on the open BBSerialTx channel.</div><div class="ttdef"><b>Definition:</b> BBSerialTx.c:279</div></div>
<div class="ttc" id="aBBSerialTx_8c_html_a9a96c8aca7c761ac5551f839af6a1c39"><div class="ttname"><a href="BBSerialTx_8c.html#a9a96c8aca7c761ac5551f839af6a1c39">BBSerialTx_Open</a></div><div class="ttdeci">bool BBSerialTx_Open(BBSerialTx_BaudRate_t baud_rate, BBSerialTx_WriteFunc_t write_function, BBSerialTx_WriteNsec_t write_duration_nsec)</div><div class="ttdoc">Opens the BBSerialTx channel.</div><div class="ttdef"><b>Definition:</b> BBSerialTx.c:51</div></div>
<div class="ttc" id="aBBSerialTx_8c_html_aceef961834b4015423081d547f913f2d"><div class="ttname"><a href="BBSerialTx_8c.html#aceef961834b4015423081d547f913f2d">BBSerialTx_WriteDecimal</a></div><div class="ttdeci">void BBSerialTx_WriteDecimal(int32_t value, size_t width)</div><div class="ttdoc">Outputs an ASCII decimal-formatted value on the open BBSerialTx channel.</div><div class="ttdef"><b>Definition:</b> BBSerialTx.c:193</div></div>
<div class="ttc" id="aBBSerialTx_8h_html"><div class="ttname"><a href="BBSerialTx_8h.html">BBSerialTx.h</a></div><div class="ttdoc">Header for bit-banged serial transmitter (8N1)</div></div>
<div class="ttc" id="aBBSerialTx_8h_html_a1fd1a4c59f016e2c4b5a14ff7db0f432"><div class="ttname"><a href="BBSerialTx_8h.html#a1fd1a4c59f016e2c4b5a14ff7db0f432">BBSerialTx_WriteNsec_t</a></div><div class="ttdeci">uint32_t BBSerialTx_WriteNsec_t</div><div class="ttdef"><b>Definition:</b> BBSerialTx.h:24</div></div>
<div class="ttc" id="aBBSerialTx_8h_html_a394d8ab04e2c74ddf60fbebfd55b35dd"><div class="ttname"><a href="BBSerialTx_8h.html#a394d8ab04e2c74ddf60fbebfd55b35dd">BBSerialTx_BaudRate_t</a></div><div class="ttdeci">uint32_t BBSerialTx_BaudRate_t</div><div class="ttdef"><b>Definition:</b> BBSerialTx.h:21</div></div>
<div class="ttc" id="aBBSerialTx_8h_html_a8611ad78cc5f08756013ff9eb760c25a"><div class="ttname"><a href="BBSerialTx_8h.html#a8611ad78cc5f08756013ff9eb760c25a">BBSerialTx_Bit_t</a></div><div class="ttdeci">BBSerialTx_Bit_t</div><div class="ttdef"><b>Definition:</b> BBSerialTx.h:12</div></div>
</div><!-- fragment --><p>Use the following command (or any other terminal emulator) to see the output from it (the adapter used here shows up as /dev/ttyUSB0 on Ubuntu 20.04):</p>
<div class="fragment"><div class="line">minicom -D /dev/ttyUSB0 -B 9600</div>
</div><!-- fragment --><p>Note that the string being output include "\r\n", which is CR-LF (Carriage Return and Line Feed). These are typically both required for terminal emulators in order to get each new line to output at the leftmost column on the terminal, although they can be configured to automatically expand LF (aka "newline") into CR-LF. Otherwise, all the output appears at the right-hand column, where you only see the last character output.</p>
<p>Example output:</p>
<div class="fragment"><div class="line">parallels@parallels-Parallels-Virtual-Platform:~/BBSerialTx$ minicom -D /dev/ttyUSB0 -b 9600</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Welcome to minicom 2.7.1</div>
<div class="line"> </div>
<div class="line">OPTIONS: I18n </div>
<div class="line">Compiled on Dec 23 2019, 02:06:26.</div>
<div class="line">Port /dev/ttyUSB0, 10:47:45</div>
<div class="line"> </div>
<div class="line">Press CTRL-A Z for help on special keys</div>
<div class="line">Hello from Arduino! Up for   128398 msec, loop count 0x00000797</div>
<div class="line">Hello from Arduino! Up for   128464 msec, loop count 0x00000798</div>
<div class="line">Hello from Arduino! Up for   128531 msec, loop count 0x00000799</div>
<div class="line">Hello from Arduino! Up for   128596 msec, loop count 0x0000079A</div>
<div class="line">Hello from Arduino! Up for   128663 msec, loop count 0x0000079B</div>
<div class="line">Hello from Arduino! Up for   128729 msec, loop count 0x0000079C</div>
<div class="line">Hello from Arduino! Up for   128795 msec, loop count 0x0000079D</div>
<div class="line">Hello from Arduino! Up for   128861 msec, loop count 0x0000079E</div>
<div class="line">CTRL-A Z for help | 9600 8N1 | NOR | Minicom 2.7.1 | VT102 | Offline | ttyUSB0</div>
</div><!-- fragment --><h1><a class="anchor" id="build_sec"></a>
Build and Test</h1>
<p>(See <a class="el" href="index.html#tools_sec">Tools</a> section below for all tools used and setup commands for Ubuntu Linux.)</p>
<p>First run CMake to prepare the build environment, creating the directory <b>build</b>. This generates makefiles and Doxygen configuration.</p>
<div class="fragment"><div class="line">cd BBSerialTx</div>
<div class="line">cmake -S . -B build</div>
</div><!-- fragment --><p>To build the Google Test suite for off-target testing:</p>
<div class="fragment"><div class="line">cmake --build build</div>
</div><!-- fragment --><p>To run the built test suite:</p>
<div class="fragment"><div class="line">build/testBBSerialTx</div>
</div><!-- fragment --><p>To run the suite under GDB for debugging (for instance, if you make changes and a test fails unexpectedly, or the program crashes):</p>
<div class="fragment"><div class="line">gdb build/testBBSerialTx</div>
</div><!-- fragment --><p>To perform code analysis:</p>
<div class="fragment"><div class="line">scripts/analyze build</div>
</div><!-- fragment --><p>To rebuild the documents (uses the CMake-generated Doxyfile.doxygen, not the default Doxyfile):</p>
<div class="fragment"><div class="line">cmake --build build --target doxygen</div>
</div><!-- fragment --><h1><a class="anchor" id="analysis_sec"></a>
Analysis</h1>
<p>The file <b>scripts/analyze</b> is a bash script (here using Ubuntu 20.04) that performs several analysis steps, generating the <b>analysis</b> directory.</p>
<p>The script does the following:</p><ul>
<li>Runs the Google Test suite that was built and uses the output to generate the software specification (since the suite was developed using TDD (Test-Driven Development) in a BDD (Behavior-Driven Development) style).</li>
<li>Runs the pmccabe tool to perform MCC analysis.</li>
<li>Runs the lcov and gcov tools to perform coverage analysis.</li>
</ul>
<div class="fragment"><div class="line">parallels@parallels-Parallels-Virtual-Platform:~/BBSerialTx$ scripts/analyze build</div>
<div class="line">Removing previous analysis data.</div>
<div class="line">Create analysis directory.</div>
<div class="line"> </div>
<div class="line">Generate test-driven specification.</div>
<div class="line"> </div>
<div class="line">Perform MCC analysis.</div>
<div class="line"> </div>
<div class="line">Perform coverage analysis.</div>
<div class="line">Capturing coverage data from build/CMakeFiles/BBSerialTx.dir</div>
<div class="line">Found gcov version: 9.4.0</div>
<div class="line">Using intermediate gcov format</div>
<div class="line">Scanning build/CMakeFiles/BBSerialTx.dir for .gcda files ...</div>
<div class="line">Found 1 data files in build/CMakeFiles/BBSerialTx.dir</div>
<div class="line">Processing BBSerialTx.gcda</div>
<div class="line">Finished .info-file creation</div>
<div class="line">Reading data file analysis/lcov.info</div>
<div class="line">Found 1 entries.</div>
<div class="line">Found common filename prefix &quot;/home/parallels/BBSerialTx&quot;</div>
<div class="line">Writing .css and .png files.</div>
<div class="line">Generating output.</div>
<div class="line">Processing file source/BBSerialTx.c</div>
<div class="line">Writing directory view page.</div>
<div class="line">Overall coverage rate:</div>
<div class="line">  lines......: 100.0% (84 of 84 lines)</div>
<div class="line">  functions..: 100.0% (11 of 11 functions)</div>
<div class="line"> </div>
<div class="line">Coverage results:</div>
<div class="line">File &#39;/home/parallels/BBSerialTx/source/BBSerialTx.c&#39;</div>
<div class="line">Lines executed:100.00% of 84</div>
</div><!-- fragment --><h2><a class="anchor" id="specification_sec"></a>
Specification</h2>
<p>In file <b>analysis/specification.txt</b>:</p>
<ul>
<li>PASSED: Given UnopenedBBSerialTx, When OpenedWithNullFunctionPointer Then ShouldNotOpen</li>
<li>PASSED: Given UnopenedBBSerialTx, When OpenedWithNonNullFunctionPointer Then ShouldOpen</li>
<li>PASSED: Given UnopenedBBSerialTx, When Instantiated Then ShouldNotWriteBit</li>
<li>PASSED: Given UnopenedBBSerialTx, When Opened Then ShouldWriteIdle</li>
<li>PASSED: Given OpenBBSerialTx, When Closed Then ShouldNotWriteData</li>
<li>PASSED: Given OpenBBSerialTx, When Calibrating Then ShouldWriteTestPattern</li>
<li>PASSED: Given OpenBBSerialTx, When WritingByte Then ShouldWriteStartAndStopBits</li>
<li>PASSED: Given OpenBBSerialTx, When WritingByte Then ShouldWriteBinaryData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingString Then ShouldWriteCharData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingString Then ShouldWriteTrailingSpaces</li>
<li>PASSED: Given OpenBBSerialTx, When WritingUint8 Then ShouldWriteAsciiHexData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingUint16 Then ShouldWriteAsciiHexData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingUint32 Then ShouldWriteAsciiHexData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingUint32 Then ShouldWriteLeadingZeroes</li>
<li>PASSED: Given OpenBBSerialTx, When WritingDecimal Then ShouldWriteAsciiDecimalData</li>
<li>PASSED: Given OpenBBSerialTx, When WritingNegativeDecimal Then ShouldWriteMinusSign</li>
<li>PASSED: Given OpenBBSerialTx, When WritingZeroDecimal Then ShouldWriteAsciiZero</li>
<li>PASSED: Given OpenBBSerialTx, When WritingDecimal Then ShouldWriteLeadingSpaces</li>
<li>PASSED: Given OpenBBSerialTx, When WritingNegativeDecimal Then ShouldWriteLeadingSpacesAndMinusSign</li>
</ul>
<h2><a class="anchor" id="mcc_sec"></a>
MCC Analysis</h2>
<p>In file <b>analysis/pmccabe.txt</b>:</p>
<div class="fragment"><div class="line">Modified McCabe Cyclomatic Complexity</div>
<div class="line">|   Traditional McCabe Cyclomatic Complexity</div>
<div class="line">|       |    # Statements in function</div>
<div class="line">|       |        |   First line of function</div>
<div class="line">|       |        |       |   # lines in function</div>
<div class="line">|       |        |       |       |  filename(definition line number):function</div>
<div class="line">|       |        |       |       |           |</div>
<div class="line">1       1       1       16      4       source/BBSerialTx.c(16): is_open</div>
<div class="line">3       3       5       26      10      source/BBSerialTx.c(26): write_bit</div>
<div class="line">4       4       7       51      22      source/BBSerialTx.c(51): BBSerialTx_Open</div>
<div class="line">1       1       1       77      4       source/BBSerialTx.c(77): BBSerialTx_Close</div>
<div class="line">5       5       16      103     32      source/BBSerialTx.c(103): BBSerialTx_Calibrate</div>
<div class="line">2       2       7       141     13      source/BBSerialTx.c(141): BBSerialTx_WriteByte</div>
<div class="line">5       5       10      163     21      source/BBSerialTx.c(163): BBSerialTx_WriteString</div>
<div class="line">8       8       20      193     42      source/BBSerialTx.c(193): BBSerialTx_WriteDecimal</div>
<div class="line">3       3       9       243     12      source/BBSerialTx.c(243): BBSerialTx_WriteUint8</div>
<div class="line">2       2       5       263     8       source/BBSerialTx.c(263): BBSerialTx_WriteUint16</div>
<div class="line">2       2       5       279     8       source/BBSerialTx.c(279): BBSerialTx_WriteUint32</div>
</div><!-- fragment --><h2><a class="anchor" id="coverage_sec"></a>
Test Coverage Analysis</h2>
<p>In <a href="../../analysis/gcov">analysis/gcov</a>, and HTML in <a href="../../analysis/lcov/index.html">analysis/lcov</a>.</p>
<p>Summary in <b>analysis/gcov/gcov.txt</b>:</p>
<div class="fragment"><div class="line">File &#39;/home/parallels/BBSerialTx/source/BBSerialTx.c&#39;</div>
<div class="line">Lines executed:100.00% of 84</div>
</div><!-- fragment --><h1><a class="anchor" id="tools_sec"></a>
Tools</h1>
<p>The following tools and setup commands were used here (Ubuntu 20.04 VM under Parallels on Mac):</p>
<div class="fragment"><div class="line"><span class="comment"># Install git:</span></div>
<div class="line">sudo apt install git</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install cmake:</span></div>
<div class="line">sudo apt install cmake </div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install Google Test:</span></div>
<div class="line">git clone https://github.com/google/googletest.git -b release-1.11.0</div>
<div class="line">cd googletest</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">sudo make install</div>
<div class="line">cd</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install lcov:</span></div>
<div class="line">sudo apt install lcov</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install pmccabe:</span></div>
<div class="line">sudo apt install pmccabe</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install tkdiff:</span></div>
<div class="line">sudo apt install tkcvs</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install minicom:</span></div>
<div class="line">sudo apt install minicom</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install doxygen:</span></div>
<div class="line">sudo apt install doxygen</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install dot for doxygen graphics:</span></div>
<div class="line">sudo apt install graphviz</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Install plantuml:</span></div>
<div class="line">sudo apt-get install plantuml</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Give user access to USB-connected Arduino and serial adapter via dialout and tty groups</span></div>
<div class="line"><span class="comment"># (the information for usermod says you need to log out and back in to</span></div>
<div class="line"><span class="comment"># apply it, but I had to restart my Ubuntu VM to get it to take effect;</span></div>
<div class="line"><span class="comment"># this is consistent with the experience others have posted online):</span></div>
<div class="line">sudo usermod -a -G dialout $USER</div>
<div class="line">sudo usermod -a -G tty $USER</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Show groups (after logging back in):</span></div>
<div class="line">groups</div>
</div><!-- fragment --><p>Arduino IDE for Linux: <a href="https://support.arduino.cc/hc/en-us/articles/360019833020-Download-and-install-Arduino-IDE">https://support.arduino.cc/hc/en-us/articles/360019833020-Download-and-install-Arduino-IDE</a></p>
<p>Note that these are not necessarily the latest version of all the tools. For instance, this installs an older version of plantuml that doesn't support some of the syntax documented at <a href="https://plantuml.com/">https://plantuml.com/</a>. However, these versions work together as used here. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
